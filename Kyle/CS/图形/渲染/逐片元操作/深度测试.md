绘制3D场景时，为了找出可见面，需要决定哪些部分丢弃不渲染；
最简单的做法是画家算法（painter‘s algorithm）：先绘制较远的物体，再绘制较近的物体；
![[画家算法.jpg]]
但是画家算法无法处理互相重叠的情况；
![[画家算法的缺陷.jpg]]
因此出现了Z-buffer方法，也就是深度测试；
***
##### 什么是深度？
表示一个像素在空间中和观察者的距离；
在[[观察空间]]的z轴正方向上，深度值越大表示距离观察者越远；（值越小越靠近相机）
值的范围是[0,1]；
##### 什么是深度缓存区？
显存中的一块区域，存储着屏幕上每个像素点的深度信息；
清除深度缓冲后，缓冲区的值默认为1，表示最大深度值；

深度写入只处理深度值，深度测试决定采用谁的颜色值；
***
### 深度测试 Depth Testing
决定是否将要渲染的物体的颜色值写入颜色缓存区的判定条件；（**通过深度测试，颜色值才会写入缓存区**）
开了深度测试，可以确保只有最近的面和对象会被绘制在场景中；
##### 深度测试的规则
在绘制每个像素点前，把新的深度值与目前存储的深度值比较；
-   通过测试，会取代G-Buffer的颜色值；
-   没有通过测试，保留G-Buffer的颜色值，新的颜色值被舍弃；
##### 比较函数
比较的两个值：计算得到的该像素的值 和 当前深度缓冲区中的值；
默认是当片元的深度值小于等于当前深度缓冲区中的值时，通过测试；
可以高度配置：设置比较函数；
***
### 深度写入
将要渲染的物体的深度值写入深度缓冲区；
开启深度写入，只是为了**将深度值写入缓冲区；（前提是通过深度测试）**
##### 深度写入的规则
开启深度写入后，如果一个片元：
-   没有通过深度测试，就没有权利更改深度缓冲区中的值；
-   通过深度测试，才可以用这个片元的深度值覆盖掉缓冲区中原来的值；
##### 深度写入的应用
-   如果在绘制实体，请设置为 _On_；
-   如果在绘制半透明效果，请切换到 _Off_；（半透明效果需要关闭深度写入）

